language: cpp
if: tag IS present
sudo: true
dist: trusty
git:
  depth: 1
env:
  global:
  - DEB_ROOT: "$TRAVIS_BUILD_DIR/nanogis.ubuntu"
matrix:
  include:
  - os: linux
    env: COMPILER=g++-7
    addons:
      apt:
        sources:
        - ubuntu-toolchain-r-test
        - sourceline: ppa:ubuntugis/ppa
        packages:
        - g++-7
        - libboost-dev
        - libgdal-dev
        - libproj-dev
        - qt5-default
script:
- wget -P $TRAVIS_BUILD_DIR/.. https://raw.githubusercontent.com/catchorg/Catch2/v2.0.1/single_include/catch.hpp
- cd $TRAVIS_BUILD_DIR/test
- make -f ./makefile.ubuntu test CXX=$COMPILER
- cd $TRAVIS_BUILD_DIR/example/nanogis
- qmake -qt=qt5 QMAKE_CXX=$COMPILER QMAKE_CC=$COMPILER QMAKE_LINK=$COMPILER
- make CXX=$COMPILER CC=$COMPILER LINK=$COMPILER CXXFLAGS+=-fPIC CFLAGS+=-fPIC
- cd $TRAVIS_BUILD_DIR
- mkdir $DEB_ROOT
- mkdir $DEB_ROOT/usr
- mkdir $DEB_ROOT/usr/local
- mkdir $DEB_ROOT/usr/local/bin
- cp $TRAVIS_BUILD_DIR/example/nanogis/nanogis $DEB_ROOT/usr/local/bin
- mkdir $DEB_ROOT/DEBIAN
- cp $TRAVIS_BUILD_DIR/control $DEB_ROOT/DEBIAN
- dpkg-deb --build $DEB_ROOT
deploy:
  provider: releases
  api_key:
    secure: fjX8rFCvW66vglC+BsO2QapYHyKrQbe7tBqo1uM/1C/KLNpf7FTHrq00nhQ8useiVl2A89Jof4+uyCcfDXP43HNasmZBX3G3kTw6lmDs/Gjj1kIb+6kOcuDFyE/a2TZp2YJlzc2y8BLOO3PMZxAxxEyCGBctgvohufXxIEJbK3r4Hi/UCwt+KPqvkjV9X84z1DESH/d6ZJgjaI37nfSPCcfkSQLuEtcLfVqVu3JWbhRZgof3gwxSz8D+YLdCIA2YXi/c+f0Op8CaVZz3Vz3j0AdpzQ0qRmcN9XmtrP5V0zhK24JML504Yjbuzftrsbb6y1cvHb6rjtaY1URAXQw9ocsHtZdkUNpfN39RjRoNTld0KYBPKU8deu/j+WFgY0QRMOqIb9veTnGLbBqSjF/oj8hPxscOSzGXvil4tl2s1f6rlWQMPOUREMAgLkOPWJpunbf7G+jUteKZfP2PkkezOl2ZxGSMSpYLs+0QOYYkdCcWyq35p2MlnW/aqu9gjSVlhkGIzFd5AfSOMyjiWTKYl2b1YRt3NNQqpnvnZALK8UmATGO31NwW0C4ptvRvbC6ukhUREnRnuO5NE03H2MPZBfIpiSkiNm64yfdFlCneNdt00qNTc54B1Aq86cv4A0s2luRtulSAbsRjLf62lueyPX6I2yZR+KFFiJzS5eh47OE=
  file: nanogis.ubuntu.deb
  on:
    repo: storm-ptr/bark
    tags: true
